<?xml version="1.0"?>
<launch>

    <!-- Launch file arguments -->
    <arg name="name"    default="$(optenv DEMONAME svea)"/>
    <arg name="is_sim"  default="false"/>

    <!-- Launch file constants -->
    <arg name="map_file" value="$(find svea_core)/maps/sml.yaml" />

    <!-- Start ABConnect -->
    <include file="$(find ros_abconnect)/launch/abconnect.launch">
        <arg name="host"        value="wss://intelligent-cluster-manager.herokuapp.com/signal"/>
        <arg name="name"        value="$(arg name)"/>
        <arg name="category"    value="car"/>
        <arg name="start_delay" value="2"/>
    </include>

    <!-- Set namespace -->
    <group ns="$(arg name)">

        <!-- On-Hardware -->
        <group unless="$(arg is_sim)">

            <!-- Start map server -->
            <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" output="screen"/>

            <!-- Start low-level interface -->
            <node name="serial_node" pkg="rosserial_python" type="serial_node.py">
                <param name="port" value="/dev/ttyACM0"/>
                <param name="baud" value="250000"/>
            </node>

            <!-- Start localization -->
	    <include file="$(find svea_sensors)/launch/localize.launch"/>

        </group>

        <!-- Start vehicle -->
        <node name="$(arg name)" pkg="city_lmpc" type="svea_demo.py" output="screen">
            <param name="name"      value="$(arg name)"/>
            <param name="is_sim"    value="$(arg is_sim)"/>

            <param if="$(eval name == 'obs')" type="yaml"
                   name="x0" value="[-1.70, +1.97, 0, +0.00]"/>

            <param if="$(eval name == 'ego')" type="yaml"
                   name="x0" value="[-3.21, +1.34, 0, +0.00]"/>

            <param if="$(eval name == 'onc')" type="yaml"
                   name="x0" value="[+3.22, -1.81, 0, -3.04]"/>
        </node>

    </group>

</launch>
